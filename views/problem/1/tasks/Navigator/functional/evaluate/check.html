<!DOCTYPE html>
<html>

<head>
  <title>Functional Modeling - MEttLE</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="/stylesheets/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="/stylesheets/custom/migrated.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/css/style.css">
  <link rel="stylesheet" href="/stylesheets/css/style-2.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <script src="/javascripts/vendor/Buttons.js"></script>
  <script src="/javascripts/vendor/jquery-1.12.0.js"></script>
  <script src="/javascripts/vendor/bootstrap.min.js"></script>
  <script src="/javascripts/vendor/jquery-ui.js"></script>
  <link href="/stylesheets/vendor/bootstrap-editable.css" rel="stylesheet" />
  <script src="/javascripts/vendor/bootstrap-editable.min.js"></script>
  <script src="/javascripts/vendor/pnotify.custom.min.js"></script>
  <link href="/stylesheets/custom/editable-custom.css" rel="stylesheet">
<link rel="stylesheet" href="/stylesheets/vendor/pnotify.custom.min.css">
  
</head>

<body>
<section id="middlepart">
  <div class="top-section">
    <!-- defines the top-section containg the buttons for calculator,simulator,info center, scribble pad and problem map and logout -->
    <div class="row">
        <div class="col-sm-1" style="text-align:center;vertical-align:middle" >
            <div class="hoverable-image" >
            <img  src="/images/navigator-compass.png" style="max-width:50px;height:auto; margin:12px; filter: invert() drop-shadow(1px 1px 4px rgba(0,0,0,0.4))"/>
          </div>
        </div>
        <style>
          .hoverable-image:hover{
            opacity: 0.8;
            cursor: pointer;
          }

          .hoverable-image:hover::after{
          content: "Your are currently the Navigator so you have to discuss with the Driver and cannot interact with the page.";
          display: inline-block;
          left: 0px;
          top: 0px;
          padding: 5px;
          background-color: black;
          color: white;
          }
        </style>
        <div class="col-sm-6" style="text-align:center;vertical-align:middle">
        <p>MEttLE</p> </div>
	   
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled id="problem1funcmodel_sim" type="image" src="/images/simulator.png" style="width:110px;height:67px;"/>
      </div>
      
    
    
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled id="problem1funcmodel_info" type="image" src="/images/info.png" style="width:110px;height:67px;"/>
      </div>
       
    
    
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled  id="problem1funcmodel_scribble"type="image" src="/images/scribble.png" style="width:110px;height:67px;"/>
      </div>
       
    
    
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled id="problem1funcmodel_map" type="image" src="/images/map.png" style="width:110px;height:67px;"/>
      </div>
       
      <div class="col-sm-1" style="text-align:center"> <button disabled id="problem1funcmodel_logout" style="margin-top: 8px;height: 50px;" type="button" class="btn btn-default" onclick="sel_logout()">Logout</button></div>
    </div>
  </div>
	 
  <div class="register">
      <div class="info">
        <div class="row" style="text-align:center">
				<div class="col-lg-8">
					<p style="padding-left:100px;text-align:left">What does the car need to do that requires power? </p>
					</div>
						<div class="col-lg-4">  
            <p >Problem Statement</p>
           <div id="myMenu">
           You are participating in an electric car race in which you are required to design an electric car of weight 5kg with wheel diameters of 4‚Äù that can traverse a track of 50m in less than 5 seconds. <br>Estimate the electrical power needed to achieve this performance.
          </div>
          </div>
					</div>
       
      </div>
    <div class="container-fluid">
      <div class="row activity" style="text-align:center">
        <div class="col-lg-6">
          <!-- To draw the box containing the various tasks and to navigate to any sub-task by clicking on it -->
          <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2520/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="580px" height="580px" viewBox="-30 -30 550 550" xml:space="preserve">
            
            <polygon id="problem1funcevalcheck_create" points="0,250 0,500 125,375"  class="subtask_map" />
            <text x="10" y="375" class="subtask_text">Identify
              <tspan x="10" y="395"> all actions </tspan>
            </text>
            
            
            <polygon id="problem1funcevalcheck_eval" points="0,500 125,375 130,500"  class="current_subtask_map" />
            <text x="55" y="450" class="current_subtask_text">Identify
			<tspan x="50" y="470"> dominant </tspan>
              <tspan x="50" y="490"> actions </tspan>
            </text>
            
            
            <polygon id="problem1funcevalcheck_plan" points="125,375 125,500 250,500"  class="subtask_map" />
            <text x="150" y="450" class="subtask_text">Plan
              <tspan x="150" y="470"> Next </tspan>
              <tspan x="150" y="490"> Steps</tspan>
            </text>
           
           
              <polygon class="task_map" id="problem1funcevalcheck_task2"  points="0,0 0,250 250,500 500,500"></polygon>
              <text class="task_text" x="80" y="300">
                Qualitative Modeling
              </text>
              
              
              <polygon class="task_map" id="problem1funcevalcheck_task3"  points="250,0 250,250 500,500 500,250"></polygon>
              <text class="task_text" x="280" y="250">
                Quantitative Modeling
              </text>
              
              
              <polygon class="task_map" id="problem1funcevalcheck_task4"  points="0,0 250,250 250,0"></polygon>
              <text class="task_text" x="120" y="80">
                Calculation
              </text>
              
              
              <polygon class="task_map" id="problem1funcevalcheck_task5"  points="250,0 500,250 500,0"></polygon>
              <text class="task_text" x="370" y="80">
                Evaluation
              </text>
              
              
              <text class="current_task_text" transform="rotate(-90 -10,500)" x="-10" y="500">
                Functional Modeling
              </text>
              <path id="problem1funcevalcheck_task1" d="M 0,250 L 0,500 L 250,500 Z" class="current_task_path" />
                          
          </svg>
        </div>
        <div class="col-lg-6" style="margin-top:30px;">
		<div style="height:450px;width:550px;border-style:groove;">
		<div class="row">
          <div class="col-lg-12">
          <span class = "subtask_text"> These are the actions that you identified </span>
            <div id="pre_txt" class="medium_margin rcorners">
              
            </div>
            <div class="medium_margin" style="text-align:left">
             <span class="task_text_eg"> The operating conditions of the car are the acceleration required and maximum velocity attained, as determined from the problem specifications (using the equations of motion). </span> <br><br>
			  <span class="subtask_text"> 1. What is the acceleration required from the car? <br> 
			  <textarea disabled disabled id="question0" rows="1" cols="20" name="question0">{{answerData.[0]}} </textarea> <br>
			  2. What is the maximum velocity attained by the car? <br> 
			  <textarea disabled disabled id="question1" rows="1" cols="20" name="question1">{{answerData.[1]}} </textarea> <br> <br>
			  3. Which of these actions does your list of actions include? <br> a) Accelerating over the entire track <br> b) Overcoming drag over the entire track </span>
            </div>
			</div>
			</div>
			</div>
             <div class="medium_margin subtask_text" style="width:550px">
				<button disabled style="float:right" class="btn" id="problem1funcevalcheck_fail" type="button">Included one or neither of these actions</button> 	
				<button disabled style="float:left" onclick="openfuncmodel();" class="btn btn-info" id="problem1funcevalcheck_back" type="button">Go back to identify actions</button> 
				<br><br> 
			<button disabled style="float:right" onclick="openfuncdom();" class="btn" id="problem1funcevalcheck_pass" type="button">Included both these actions</button>
			</div>
      </div>
    </div>
  </div>
  </div>
</section>
<!-- The guidance Modal -->
        <div id="problem1funcevalcheck_modal" class="modal" tabindex="-1" data-backdrop="false">
          <!-- Modal content -->
          <div class="modal-content">
          <span class="close">&times;</span>
          <span class="subtask_text"> Go back and revise your list. <br> You may want to look at the Simulator to understand what the car needs to do that requires power. </span><br>
          <button disabled style="float:centre" onclick="openfuncprompts();" class="btn btn-primary" id="problem1funcevalcheck_prompts" type="button">Guide Me</button> <br>
        </div>
        </div>
<!-- modal for explanation -->
      <div aria-hidden="true" class="modal fade" data-backdrop="false" id="ExplnModal" role="dialog" tabindex="-1" >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-heading">
               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h2 class="modal-title">Type the answer to the question below while discussing with your partner</h2>
            </div>
            <div class=" medium_margin"> What were you thinking as you solved that step and what did you learn? </div>
            <div style="margin:20px"><textarea id="explain0" class="form-control input-large " rows="5">{{answerData.[2]}}</textarea>
            </div>
            <div class="modal-body" style="float:center">
              <button type="button" class="btn btn-primary" onclick="logRecordAndJump(desturl)">Continue</button>
            </div>
          </div>
        </div>
    </div>
</body>
<script src="/socket.io/socket.io.js"></script>

<script>
var socket = io('http://10.68.6.172:8080');
var name = "{{ sessionName }}";

// open problem statement
mnuOut=false;
$('#menuTrigger').click(function(){
  if (mnuOut){
      //Menu is visible, so HIDE menu
      $('#myMenu').animate({
        right: '-200px'
      },800);
      mnuOut = false;
  }else{
      //Menu is hidden, so SHOW menu
      $('#myMenu').animate({
        right: 0
      },800);
      mnuOut = true;
  }
}) 

var windows=[];
var bc = new BroadcastChannel('logoff_channel');
bc.onmessage =  function(event){
  if (event.data=='logoff')
  {
    sel_logout();
  }
}

window.onbeforeunload = function(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
}

//get action list from model page
$.get( "/api/problem/answer", { pageID: "/problem/1/tasks/role/functional/model/main", questionID: 0 } )
  .done(function( data ) {
  //alert( "Data Loaded: " + JSON.parse(data));
    $("#pre_txt").html(JSON.parse(data)[0]);
  });
  
  // post evaluation question answers to database
  $("#question0").focusout(function() {
    submiQuestion("0",  $("#question0").val());
  });
  $("#question1").focusout(function() {
    submiQuestion("1", $("#question1").val());
  });
  
  
   function submiQuestion(pk,value) {
      $.post("/api/problem/answer", { pk: pk, pageID: window.location.pathname, value: value })
        .done(function(data) {
          if (data.includes("success")) {
            //console.log("Data saved " + data);
          }
          else {
             //console.log("Please try again ");
          }
        });
    }

   // Get the modal
var modal = document.getElementById('problem1funcevalcheck_modal');

// Get the button that opens the modal
var btn = document.getElementById("problem1funcevalcheck_fail");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
    modal.style.display = "block";
    logRecord("problem1funcevalcheck_guideme")
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modal.style.display = "none";
     logRecord("problem1funcevalcheck_closeguideme")
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
        logRecord("problem1funcevalcheck_closeguideme")
    }
}

 //automatically save and share explanation
$("#explain0").keyup(function() { 
socket.emit('Driver-submit-question', {
      content: $("#explain0").val(),
      text: name
    });
});

//automatically save and share explanation
$("#explain0").focusout(function() { 
    submiQuestion("2", $("#explain0").val());
  });

  var desturl = " ";
  function explanation(url){
  $('#ExplnModal').modal("show");
  desturl = url;
}

    function openfuncmodel() {
      explanation("/problem/1/tasks/role/functional/model/main")
  }

    // opens the page when the respective svg is clicked
  function openfunceval() {
    logRecordAndJump("/problem/1/tasks/role/functional/evaluate/check")
  }
  function openfuncprompts() {
    explanation("/problem/1/tasks/role/functional/model/prompts")
  }

  function openfuncdom() {
    explanation("/problem/1/tasks/role/functional/evaluate/dominant")
  }

  // opens the page when the respective svg is clicked
  function openfuncplan() {
    explanation("/problem/1/tasks/role/functional/plan")
  }

  function openqual() {
    explanation("/problem/1/tasks/role/qualitative/model")
   }

  function openquant() {
    explanation("/problem/1/tasks/role/quantitative/model")
  }


  function opencalc() {
    explanation("/problem/1/tasks/role/calculation/calculation")
  }

  function openeval() {
    explanation("/problem/1/tasks/role/evaluation/evaluation")
  }

function sendSimulatorLog(){
   windows.push(window.open("/problem/1/tasks/Navigator/simulator", '_blank'));
}

function sendInformationLog(){
  windows.push(window.open("/problem/1/tasks/Navigator/information", '_blank'));
  
}

function sendScratchLog(){
  windows.push(window.open("/problem/1/tasks/Navigator/scribble", '_blank'));
  
}

function sendProblemMapLog(){
  windows.push(window.open("/problem/1/tasks/Navigator/aboutproblem", '_blank'));
  
}

function sel_logout(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
  logRecord('/Logout');
  window.open("/logout", '_self');
}
  

function sendprobsmtlog(){
  logRecord('View_prob_smt');
}
 
 function clickIncludedOneButton(){
 	logRecord("problem1funcevalcheck_fail")
 }

 function logRecordAndJump(urlString) {
    //urlString = $.checkURL(urlString);
    // console.log("in logrecord");
    // $.getscript("routes/api.js",function(){
    //   console.log("in get script");
    // urlString = checkURL(urlString);
    // });
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("data saved");
          //console.log(JSON.parse(data).role);
          window.open(urlString.replace("role", JSON.parse(data).role), target = "_self");
        } else {
          //console.log("Please try again ");
        }
      });
    socket.emit('Driver-next', {
      text: name,
      nexturl: urlString
    });
    }
 

function logRecordAndOpen(urlString){
	$.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
			  window.open(urlString, target = "_blank");
            }
            else {
              //console.log("Please try again ");
            }
          });
}

function logRecord(urlString){
	$.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
            }
            else {
              //console.log("Please try again ");
            }
          });
}
</script>
<script src="/javascripts/custom/map-header-socket-navigator-script.js" defer></script>
