<!DOCTYPE html>
<html>

<head>
  <title>Qualitative Modeling - MEttLE</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script src="/javascripts/vendor/go.js"></script>
  <script src="/javascripts/vendor/NodeLabelDraggingTool.js"></script>
  <link rel="stylesheet" href="/stylesheets/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="/stylesheets/custom/migrated.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/css/style.css">
  <link rel="stylesheet" href="/stylesheets/css/style-2.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <script src="/javascripts/vendor/Buttons.js"></script>
  <script src="/javascripts/vendor/jquery-1.12.0.js"></script>
  <script src="/javascripts/vendor/bootstrap.min.js"></script>
  <script src="/javascripts/vendor/jquery-ui.js"></script>
  <link href="/stylesheets/vendor/bootstrap-editable.css" rel="stylesheet" />
  <script src="/javascripts/vendor/bootstrap-editable.min.js"></script>
  <script src="/javascripts/vendor/pnotify.custom.min.js"></script>
  <link href="/stylesheets/custom/editable-custom.css" rel="stylesheet">
<link rel="stylesheet" href="/stylesheets/vendor/pnotify.custom.min.css">
  
</head>

<body onLoad="init()">
  <section id="middlepart">
      <div class="top-section">
          <!-- defines the top-section containg the buttons for calculator,simulator,info center, scribble pad and problem map and logout -->
          <div class="row">
              <div class="col-sm-1" style="text-align:center;vertical-align:middle" >
            <div class="hoverable-image" >
            <img  src="/images/navigator-compass.png" style="max-width:50px;height:auto; margin:12px; filter: invert() drop-shadow(1px 1px 4px rgba(0,0,0,0.4))"/>
          </div>
        </div>
        <style>
          .hoverable-image:hover{
            opacity: 0.8;
            cursor: pointer;
          }

          .hoverable-image:hover::after{
          content: "Your are currently the Navigator so you have to discuss with the Driver and cannot interact with the page.";
          display: inline-block;
          left: 0px;
          top: 0px;
          padding: 5px;
          background-color: black;
          color: white;
          }
        </style>
        <div class="col-sm-6" style="text-align:center;vertical-align:middle">
              <p>MEttLE</p></div>
	   
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled id="problem1funcmodel_sim" type="image" src="/images/simulator.png" style="width:110px;height:67px;"/>
      </div>
      
    
    
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled id="problem1funcmodel_info" type="image" src="/images/info.png" style="width:110px;height:67px;"/>
      </div>
       
    
    
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled  id="problem1funcmodel_scribble"type="image" src="/images/scribble.png" style="width:110px;height:67px;"/>
      </div>
       
    
    
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input disabled id="problem1funcmodel_map" type="image" src="/images/map.png" style="width:110px;height:67px;"/>
      </div>
       
      <div class="col-sm-1" style="text-align:center"> <button disabled id="problem1funcmodel_logout" style="margin-top: 8px;height: 50px;" type="button" class="btn btn-default" onclick="sel_logout()">Logout</button></div>
    </div>
  </div>
		
    <div class="register">
       <div class="info">
         	<div class="row" style="text-align:center">
				<div class="col-lg-8">
					<p style="padding-left:100px;text-align:left">What are the parameters that affect the dominant mechanical power required? </p>
					</div>
					<div class="col-lg-4">  
            <p>Problem Statement </p>
           <div id="myMenu">
           You are participating in an electric car race in which you are required to design an electric car of weight 5kg with wheel diameters of 4‚Äù that can traverse a track of 50m in less than 5 seconds. <br>Estimate the electrical power needed to achieve this performance.
          </div>
          </div>
					</div>  
      </div>
      <div class="container-fluid">
        <div class="row activity" style="text-align:center">
          <div class="col-lg-6">
            <!-- To draw the box containing the various tasks and to navigate to any sub-task by clicking on it -->
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2520/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="580px"
              height="580px" viewBox="-30 -30 550 550" xml:space="preserve">

              <polygon id="problem1qualmodel_task1"  points="0,250 0,500 250,500" class="task_map" />
              <text x="5" y="450" class="task_text"> Functional Modeling</text>
              

              <polygon id="problem1qualmodel_create" points="0,0 0,250 250,500 250,250"  class="current_subtask_map"
              />
              <text x="60" y="250" class="current_subtask_text">Create a causal map</text>
              
              
              <polygon id="problem1qualmodel_eval" points="250,250 250,500 375,375"  class="subtask_map" />
              <text x="260" y="365" class="subtask_text">Identify 
                    <tspan x="260" y="385"> dominant </tspan>
                    <tspan x="260" y="405"> parameters</tspan>
                  </text>
              
              
              <polygon id="problem1qualmodel_plan" points="250,500 375,375 500,500" class="subtask_map" />
              <text x="320" y="470" class="subtask_text">Plan Next steps</text>

             
              <polygon id="problem1qualmodel_task3" points="250,0 250,250 500,500 500,250"  class="task_map" />
              <text x="280" y="250" class="task_text"> Quantitative Modeling </text>

             
              <polygon class="task_map" id="problem1funcmodel_task4"  points="0,0 250,250 250,0"></polygon>
              <text class="task_text" x="120" y="80">
                Calculation
              </text>
              
              
              <polygon class="task_map" id="problem1funcmodel_task5"  points="250,0 500,250 500,0"></polygon>
              <text class="task_text" x="370" y="80">
                Evaluation
              </text>
              
              
			   <text  x="-10" y="220" transform="rotate(-90 -10,220)" class="current_task_text"> Qualitative Modeling </text>	
              <path id="problem1qualmodel_task2" d="M 0,0 L 0,250 L 250,500 L 500,500 Z" class="current_task_path"/> 
            </svg>
          </div>
          <div class="col-lg-6" style="margin-top: 30px;"> 
             <div style="height:550px;width:550px;border-style: groove;">
               <div class="medium_margin">
                 <span class="current_subtask_text"> Draw a causal map showing the qualitative relationships between total power required and all the parameters that affect power. </span> <br>
<span class="subtask_text"> You may use the Simulator available at the top of the page. <br> See the sample diagram below. You can change it and create your own. Double click on the canvas below to add a node. </span>
<button disabled style="float:right" class="btn btn-primary" id="problem1qualmodel_guide" type="button">Guide Me</button>
               <div class="row medium_margin">
              <div id="problem1qualmodel_myDiagramDiv2" style="background-color: whitesmoke; border: solid 1px black; width: 95%; height: 360px;margin-bottom: 10px;"></div>
			  <button disabled type="button" class="btn btn-primary btn-sm editable-submit" onclick="save()"><i class="glyphicon glyphicon-ok"></i></button>
                <button disabled type="button" class="btn btn-default btn-sm editable-cancel" onclick="clearData()"><i class="glyphicon glyphicon-remove"></i></button>
            </div>
               </div>
			   </div>
               <div class="medium_margin" style="width:550px">
              <button disabled style="float:right" onclick="openqualeval();" class="btn" id="problem1qualmodel_next" type="button">Check your causal map</button>
            </div>
            </div>
          </div>
        </div>
      </div>
     </section>
     <!-- The guide me Modal -->
        <div id="problem1qualmodel_modal" class="modal" tabindex="-1" data-backdrop="false">
          <!-- Modal content -->
          <div class="modal-content txt_left">
          <span class="close">&times;</span>
          <span class="subtask_text"> A causal map is a diagram in which nodes (squares) indicate the parameters and the links between the nodes (arrows) indicate the causal relationship between the two parameters or how one parameter affects the other. <br> <br>
          Look at the simulator graphs showing the relationship between the total power required by a car and various parameters. <br>
a) Vary one parameter at a time. <br>
b) Observe the graphs and note how changing the parameter affects power.  <br>
c) Observe if the effect is linear or non-linear, directly proportional or inversely proportional and indicate the relationship on the causal map.<br>
 </span><br>
        </div>
        </div>
        <!-- modal for explanation -->
      <div aria-hidden="true" class="modal fade" data-backdrop="false" id="ExplnModal" role="dialog" tabindex="-1" >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-heading">
               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h2 class="modal-title">Type the answer to the question below while discussing with your partner</h2>
            </div>
            <div class=" medium_margin"> What were you thinking as you solved that step and what did you learn? </div>
            <div style="margin:20px"><textarea id="explain0" class="form-control input-large " rows="5">{{answerData.[1]}}</textarea>
            </div>
            <div class="modal-body" style="float:center">
              <button type="button" class="btn btn-primary" onclick="logRecordAndJump(desturl)">Continue</button>
            </div>
          </div>
        </div>
    </div>
</body>
<script src="/socket.io/socket.io.js"></script>

<script>
var socket = io('http://10.68.6.172:8080');
var name = "{{ sessionName }}";

    // open problem statement
mnuOut=false;
$('#menuTrigger').click(function(){
  if (mnuOut){
      //Menu is visible, so HIDE menu
      $('#myMenu').animate({
        right: '-200px'
      },800);
      mnuOut = false;
  }else{
      //Menu is hidden, so SHOW menu
      $('#myMenu').animate({
        right: 0
      },800);
      mnuOut = true;
  }
}) 

var windows=[];
var bc = new BroadcastChannel('logoff_channel');
bc.onmessage =  function(event){
  if (event.data=='logoff')
  {
    sel_logout();
  }
}

window.onbeforeunload = function(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
}


  function init() {
    if (window.goSamples) goSamples(); // init for these samples -- you don't need to call this
    var $ = go.GraphObject.make; // for conciseness in defining templates

    //causal map
    myDiagram2 =
      $(go.Diagram, "problem1qualmodel_myDiagramDiv2", // must name or refer to the DIV HTML element
        {
          // start everything in the middle of the viewport
          initialContentAlignment: go.Spot.Center,
          // have mouse wheel events zoom in and out instead of scroll up and down
          
          // support double-click in background creating a new node
          
          // enable undo & redo
          "undoManager.isEnabled": false
        });
    
    /*
        // install the NodeLabelDraggingTool as a "mouse move" tool
    myDiagram2.toolManager.mouseMoveTools.insertAt(0, new NodeLabelDraggingTool());
    // when the document is modified, add a "*" to the title and enable the "Save" button
    myDiagram2.addDiagramListener("Modified", function (e) {
      var button = document.getElementById("problem1qualmodel_save");
      if (button) button.disabled = !myDiagram2.isModified;
      var idx = document.title.indexOf("*");
      if (myDiagram2.isModified) {
        if (idx < 0) document.title += "*";
      } else {
        if (idx >= 0) document.title = document.title.substr(0, idx);
      }
    });

    */
    // define the Node template
    myDiagram2.nodeTemplate =
      $(go.Node, "Spot", {
          locationObjectName: "ICON",
          locationSpot: go.Spot.Center
        },
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify), {
          selectionObjectName: "ICON"
        },
        // define the node primary shape
        $(go.Shape, "RoundedRectangle", {
          name: "ICON",
          parameter1: 10, // the corner has a medium radius
          desiredSize: new go.Size(40, 40),
          fill: $(go.Brush, "Linear", {
            0: "rgb(254, 201, 0)",
            1: "rgb(254, 162, 0)"
          }),
          stroke: "black",
          portId: "",
          fromLinkable: true,
          fromLinkableSelfNode: true,
          fromLinkableDuplicates: true,
          toLinkable: true,
          toLinkableSelfNode: true,
          toLinkableDuplicates: true,
          cursor: "pointer"
        }),
        $(go.Shape, // provide interior area where the user can grab the node
          {
            fill: "transparent",
            stroke: null,
            desiredSize: new go.Size(30, 30)
          }),
        $(go.TextBlock, {
            font: "bold 11pt helvetica, bold arial, sans-serif",
            editable: true, // editing the text automatically updates the model data
            _isNodeLabel: true,
            cursor: "move" // visual hint that the user can do something with this node label
          },
          new go.Binding("text", "text").makeTwoWay(),
          // The GraphObject.alignment property is what the NodeLabelDraggingTool modifies.
          // This TwoWay binding saves any changes to the same named property on the node data.
          new go.Binding("alignment", "alignment", go.Spot.parse).makeTwoWay(go.Spot.stringify)
        )
      );
      
    
    // unlike the normal selection Adornment, this one includes a Button
    myDiagram2.nodeTemplate.selectionAdornmentTemplate =
      $(go.Adornment, "Spot",
        $(go.Panel, "Auto",
          $(go.Shape, {
            fill: null,
            stroke: "blue",
            strokeWidth: 2
          }),
          $(go.Placeholder) // this represents the selected Node
        ),
        // the button to create a "next" node, at the top-right corner
        $("Button", {
            alignment: go.Spot.TopRight,
            click: addNodeAndLink // this function is defined below
          },
          $(go.Shape, "PlusLine", {
            desiredSize: new go.Size(6, 6)
          })
        ) // end button
      ); // end Adornment
    // clicking the button inserts a new node to the right of the selected node,
    // and adds a link to that new node
    function addNodeAndLink(e, obj) {
      var adorn = obj.part;
      e.handled = true;
      var diagram = adorn.diagram;
      diagram.startTransaction("Add State");
      // get the node data for which the user clicked the button
      var fromNode = adorn.adornedPart;
      var fromData = fromNode.data;
      // create a new "State" data object, positioned off to the right of the adorned Node
      var toData = {
        text: "new"
      };
      var p = fromNode.location.copy();
      p.x += 200;
      toData.loc = go.Point.stringify(p); // the "loc" property is a string, not a Point object
      // add the new node data to the model
      var model = diagram.model;
      model.addNodeData(toData);
      // create a link data from the old node data to the new node data
      var linkdata = {
        from: model.getKeyForNodeData(fromData), // or just: fromData.id
        to: model.getKeyForNodeData(toData),
        text: "transition"
      };
      // and add the link data to the model
      model.addLinkData(linkdata);
      // select the new Node
      var newnode = diagram.findNodeForData(toData);
      diagram.select(newnode);
      diagram.commitTransaction("Add State");
      // if the new node is off-screen, scroll the diagram to show the new node
      diagram.scrollToRect(newnode.actualBounds);
    }

    
    // replace the default Link template in the linkTemplateMap
    myDiagram2.linkTemplate =
      $(go.Link, // the whole link panel
        {
          curve: go.Link.Bezier,
          adjusting: go.Link.Stretch,
          reshapable: true
        },
        new go.Binding("points").makeTwoWay(),
        new go.Binding("curviness", "curviness"),
        $(go.Shape, // the link shape
          {
            strokeWidth: 1.5
          }),
        $(go.Shape, // the arrowhead
          {
            toArrow: "standard",
            stroke: null
          }),
        $(go.Panel, "Auto",
          $(go.Shape, // the label background, which becomes transparent around the edges
            {
              fill: $(go.Brush, "Radial", {
                0: "rgb(240, 240, 240)",
                0.3: "rgb(240, 240, 240)",
                1: "rgba(240, 240, 240, 0)"
              }),
              stroke: null
            }),
          $(go.TextBlock, "transition", // the label text
            {
              textAlign: "center",
              font: "10pt helvetica, arial, sans-serif",
              stroke: "black",
              margin: 4,
              editable: true // editing the text automatically updates the model data
            },
            new go.Binding("text", "text").makeTwoWay())
        )
      );

    // read in the JSON-format data from the "mySavedModel" element
    load();
  }
  // Show the diagram's model in JSON format
  /*function save() {
    //document.getElementById("problem1qualmodel_jsonmodel").value = myDiagram2.model.toJson();
    myDiagram2.isModified = false;
    submiQuestion("0",myDiagram2.model.toJson());
	logRecord('qual_save_model')
  }
  
  
  function cleardata(){
    myDiagram2.model=go.Model.fromJson(JSON.parse("{}"));
    submiQuestion("0",myDiagram2.model.toJson());
	logRecord('qual_clear_model')
  }*/
  
  function submiQuestion(pk, value) {
        $.post("/api/problem/answer", { pk: pk, pageID: window.location.pathname, value: value })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
            }
            else {
              //console.log("Please try again ");
            }
          });
      }
  //loads the model based on the value in the textarea
  function load() {
    var blank_data='{ "class": "go.GraphLinksModel",'+
  '"nodeDataArray": [ {"text":"Power", "key":-1, "loc":"222.33331298828125 183.66666412353516"},'+
'{"text":"Mass", "loc":"422.33331298828136 183.6666641235351", "key":-2} ],'+
  '"linkDataArray": [ {"from":-1, "to":-2, "text":"increases with", "points":[242.82187115504692,179.20656982872902,295.8333129882813,167.66666412353513,348.8333129882813,167.66666412353513,401.84475482151566,179.206569828729]} ]}';
    
    // myDiagram2.model = go.Model.fromJson(document.getElementById("problem1qualmodel_jsonmodel").value);
    $.get("/api/problem/answer", { pageID: "/problem/1/tasks/role/qualitative/model" , questionID: 0})
        .done(function(data) {
          //  alert( "Data Loaded: " + data );
          if((data=='[]') || JSON.parse((JSON.parse(data)[0])).nodeDataArray.length < 1){
             $('#show_blank').show();
            myDiagram2.model=go.Model.fromJson(blank_data);
          }else{
            $('#show_blank').hide();
            myDiagram2.model=go.Model.fromJson((JSON.parse(data)[0]));
          }
        });
  }
  //automatically save and share explanation
$("#explain0").keyup(function() { 
socket.emit('Driver-submit-question', {
      content: $("#explain0").val(),
      text: name
    });
});

//automatically save and share explanation
$("#explain0").focusout(function() { 
    submiQuestion("1", $("#explain0").val());
  });

  var desturl = " ";
  function explanation(url){
  $('#ExplnModal').modal("show");
  desturl = url;
}

    function openfunc() {
      explanation("/problem/1/tasks/role/functional/model/main")
  }

    function openqual() {
    logRecordAndJump("/problem/1/tasks/role/qualitative/model")
   }

   function openqualeval() {
    explanation("/problem/1/tasks/role/qualitative/evaluate/check")
  }

  function openqualplan() {
    explanation("/problem/1/tasks/role/qualitative/plan")
  }

  function openquant() {
    explanation("/problem/1/tasks/role/quantitative/model")
  }


  function opencalc() {
    explanation("/problem/1/tasks/role/calculation/calculation")
  }
 
  function openeval() {
    explanation("/problem/1/tasks/role/evaluation/evaluation")
  }

  
  function sendSimulatorLog(){
   windows.push(window.open("/problem/1/tasks/navigator/simulator", '_blank'));
}

function sendInformationLog(){
  windows.push(window.open("/problem/1/tasks/navigator/information", '_blank'));
  
}

function sendScratchLog(){
  windows.push(window.open("/problem/1/tasks/navigator/scribble", '_blank'));
  
}

function sendProblemMapLog(){
  windows.push(window.open("/problem/1/tasks/navigator/aboutproblem", '_blank'));
  
}

function sel_logout(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
  logRecord('/Logout');
  window.open("/logout", '_self');
}
 
  function sendprobsmtlog(){
  logRecord('View_prob_smt');
}
// Get the modal
var modal = document.getElementById('problem1qualmodel_modal');

// Get the button that opens the modal
var btn = document.getElementById('problem1qualmodel_guide');

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
    modal.style.display = "block";
    logRecord("problem1qualmodel_guideme")
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modal.style.display = "none";
    logRecord("problem1qualmodel_closeguideme")
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
        logRecord("problem1qualmodel_closeguideme")
    }
}

function logRecordAndJump(urlString) {
    //urlString = $.checkURL(urlString);
    // console.log("in logrecord");
    // $.getscript("routes/api.js",function(){
    //   console.log("in get script");
    // urlString = checkURL(urlString);
    // });
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("data saved");
          //console.log(JSON.parse(data).role);
          window.open(urlString.replace("role", JSON.parse(data).role), target = "_self");
        } else {
          //console.log("Please try again ");
        }
      });
    socket.emit('Driver-next', {
      text: name,
      nexturl: urlString
    });
    }
 
  
function logRecordAndOpen(urlString){
	$.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
			  window.open(urlString, target = "_blank");
            }
            else {
              //console.log("Please try again ");
            }
          });
}

function logRecord(urlString){
	$.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
            }
            else {
              //console.log("Please try again ");
            }
          });
}
</script>
<script src="/javascripts/custom/map-header-socket-navigator-script.js"></script>
