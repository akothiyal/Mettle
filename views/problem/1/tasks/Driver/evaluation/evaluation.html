<!DOCTYPE html>
<html>

<head>
  <title>Evaluation - MEttLE</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/stylesheets/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="/stylesheets/custom/migrated.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/css/style.css">
  <link rel="stylesheet" href="/stylesheets/css/style-2.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <script src="/javascripts/vendor/Buttons.js"></script>
  <script src="/javascripts/vendor/jquery-1.12.0.js"></script>
  <script src="/javascripts/vendor/bootstrap.min.js"></script>
  <script src="/javascripts/vendor/jquery-ui.js"></script>
  <link href="/stylesheets/vendor/bootstrap-editable.css" rel="stylesheet" />
  <script src="/javascripts/vendor/bootstrap-editable.min.js"></script>
  <script src="/javascripts/vendor/pnotify.custom.min.js"></script>
  <link href="/stylesheets/custom/editable-custom.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/vendor/pnotify.custom.min.css">
</head>

<section id="middlepart">
  <div class="top-section">
    <div class="row">
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <div class="hoverable-image">
          <img onclick="navigatorinfo()" src="/images/steering-wheel.png"
            style="max-width:50px;height:auto; margin:12px; filter: invert() drop-shadow(1px 1px 4px rgba(0,0,0,0.4))" />
        </div>
      </div>
      <style>
        .hoverable-image:hover {
          opacity: 0.8;
          cursor: pointer;
        }

        .hoverable-image:hover::after {
          content: "your are currently the driver so you are the one to interact with the page and submit inputs";
          display: inline-block;
          left: 0px;
          top: 0px;
          padding: 5px;
          background-color: black;
          color: white;
        }
      </style>
      <div class="col-sm-6" style="text-align:center;vertical-align:middle">
        <p>MEttLE</p>
      </div>
      <g onclick="sendSimulatorLog()">
        <div class="col-sm-1" style="text-align:center;vertical-align:middle">
          <input id="problem1funcmodel_sim" type="image" src="/images/simulator.png" style="width:110px;height:67px;" />
        </div>
      </g>

      <g onclick="sendInformationLog()">
        <div class="col-sm-1" style="text-align:center;vertical-align:middle">
          <input id="problem1funcmodel_info" type="image" src="/images/info.png" style="width:110px;height:67px;" />
        </div>
      </g>

      <g onclick="sendScratchLog()">
        <div class="col-sm-1" style="text-align:center;vertical-align:middle">
          <input id="problem1funcmodel_scribble" type="image" src="/images/scribble.png"
            style="width:110px;height:67px;" />
        </div>
      </g>

      <g onclick="sendProblemMapLog()">
        <div class="col-sm-1" style="text-align:center;vertical-align:middle">
          <input id="problem1funcmodel_map" type="image" src="/images/map.png" style="width:110px;height:67px;" />
        </div>
      </g>
      <div class="col-sm-1" style="text-align:center"> <button id="problem1funcmodel_logout"
          style="margin-top: 8px;height: 50px;" type="button" class="btn btn-default"
          onclick="sel_logout()">Logout</button></div>
    </div>
  </div>


  <div class="register">
    <div class="info">
      <div class="row" style="text-align:center">
        <div class="col-lg-8">
          <p style="padding-left:100px;text-align:left">Is the estimated value of power reasonable?
          </p>
        </div>
        <div class="col-lg-4">
          <g onclick="sendprobsmtlog()"><a id="menuTrigger" class="dropdown-toggle" data-toggle="dropdown">Problem
              Statement</a></g>
          <div id="myMenu">
            You are participating in an electric car race in which you are required to design an electric car of weight
            5kg with wheel diameters of 4‚Äù that can traverse a track of 50m in less than 5 seconds. <br>Estimate the
            electrical power needed to achieve this performance.
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row activity" style="text-align:center">
        <div class="col-lg-6">
          <!-- To draw the box containing the various tasks and to navigate to any sub-task by clicking on it -->
          <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2520/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            width="580px" height="580px" viewBox="-30 -30 550 550" xml:space="preserve">

            <g onclick="openfunc()">
              <polygon id="problem1eval_task1" points="0,250 0,500 250,500" class="task_map" />
              <text x="5" y="450" class="task_text"> Functional Modeling</text>
            </g>
            <g onclick="openqual()">
              <polygon id="problem1eval_task2" points="0,0 0,250 250,500 500,500" class="task_map" />
              <text x="80" y="300" class="task_text"> Qualitative Modeling </text>
            </g>
            <g onclick="openquant()">
              <polygon id="problem1eval_task3" points="250,0 250,250 500,500 500,250" class="task_map" />
              <text x="280" y="250" fill="#000000" font-size="18"> Quantitative Modeling </text>
            </g>
            <g onclick="opencalc()">
              <polygon id="problem1eval_task4" points="0,0 250,250 250,0" class="task_map" />
              <text x="120" y="80" class="task_text"> Calculation </text>
            </g>
            <!-- <g onclick="openeval()">-->
            <polygon points="250,0 500,0 375,125" class="current_subtask_map" />
            <text x="340" y="40" class="current_subtask_text">Order of <tspan x="340" y="60"> magnitude </tspan> </text>
            <polygon points="500,0 375,125 500,250" class="current_subtask_map" />
            <text x="400" y="130" class="current_subtask_text">Comparable <tspan x="400" y="150"> Values </tspan>
            </text>

            <text x="350" y="-10" class="task_text">Evaluation </text>
            <path id="problem1eval_task5" d="M 250,0 L 500,250 L 500,0 Z" class="current_task_path" /> <!-- </g>-->

          </svg>
        </div>
        <div class="col-lg-6" style="margin-top: 30px;">
          <div class="subtask_text" style="height:550px;width:550px;border-style: groove;">
            The estimate you obtained for power is
            <div id="pre_txt" class="medium_margin rcorners txt_left">
            </div>
            <div class="medium_margin ">
              <div class=" medium_margin subtask_text txt_left">1) Divya solved this problem and got an answer of 8W.
                John thinks the estimate is lower than the expected order of magnitude of power. Is John right? Explain
                why or why not. &nbsp&nbsp&nbsp&nbsp&nbsp <div class="popup"><button style="float:right"
                    onClick="openq1hint()" class="btn btn-warning" id="problem1eval_q1" type="button">Hint</button>
                  <span class="popuptextsmall" id="problem1eval_q1hint">Think of your past experiences with similar
                    objects ( a toy car vs a Honda Accord). Ask your intuition whether the power lies between these two
                    extreme cases of a car. If you are unsure of the power required by a toy car or a Honda Accord,
                    consult the power list given in the Info Center.
                  </span></div>
              </div>
              <textarea id="question0" rows="4" cols="50" name="question0">{{answerData.[0]}}
              				</textarea>
            </div>
            <div class="medium_margin ">
              <div class=" medium_margin subtask_text txt_left">2) Dennis and Maria are working on a project and propose
                to use the motor of an old blender to build this car. Will it be feasible? Explain how it might or might
                not be feasible. &nbsp&nbsp&nbsp&nbsp&nbsp <div class="popup"> <button style="float:right"
                    onClick="openq2hint()" class="btn btn-warning" id="problem1eval_q2" type="button">Hint</button>
                  <span class="popuptextsmall" id="problem1eval_q2hint">A blender typically has a power rating of a few
                    hundred watts. Think of what a blender has to do and what a car has to do. Which action requires
                    more power? If the cars' actions require lesser power than the blender, then the blender motor can
                    be used, otherwise it cannot.

                  </span></div>
              </div>
              <textarea id="question1" rows="4" cols="50" name="question1">{{answerData.[1]}}
              				</textarea>
            </div>
            <div class="medium_margin">
              <table class="medium_margin" width="70%">
                <tr>
                  <td>I answered yes to both questions</td>
                  <td class="medium_margin"> <input type="radio" id="yes" name="opt" value="1"
                      onclick="socket.emit('Driver-eval-check-complete',{text:name});" checked></input></td>

                </tr>
                <tr>
                  <td>I answered no to one of the questions</td>
                  <td class="medium_margin"> <input type="radio" id="no" name="opt" value="0"
                      onclick="socket.emit('Driver-eval-check-incomplete',{text:name});" checked></input></td>
                  <td><button onClick="submitFun()" id="submit">Submit</button></td>
                </tr>

              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- modal for explanation -->
<div aria-hidden="true" class="modal fade" data-backdrop="false" id="ExplnModal" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-heading">
        <button disabled type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h2 class="modal-title">Discuss with your partner while they type the answer to the question below</h2>
      </div>
      <div class=" medium_margin"> What were you thinking as you solved that step and what did you learn? </div>
      <div style="margin:20px"><textarea disabled id="explain0" class="form-control input-large "
          rows="5">{{answerData.[3]}}</textarea>
      </div>
      <div class="modal-body" style="float:center">
        <button disabled type="button" class="btn btn-primary" onclick="logRecordAndJump(desturl)">Continue</button>
      </div>
    </div>
  </div>
</div>
</body>

<script src="/javascripts/vendor/jquery-2.2.1.min.js"></script>
<script src="/javascripts/vendor/bootstrap.min.js"></script>
<script src="/javascripts/vendor/jquery-ui.js"></script>
<script src="/javascripts/vendor/common.js"></script>
<script src="/javascripts/vendor/pnotify.custom.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>
  var socket = io('http://10.68.6.172:8080');
  var name = "{{ sessionName }}";
//window.onclose = socket.emit('Driver-close-window',{text:name});

  // open problem statement
  mnuOut = false;
  $('#menuTrigger').click(function () {
    if (mnuOut) {
      //Menu is visible, so HIDE menu
      $('#myMenu').animate({
        right: '-200px'
      }, 800);
      mnuOut = false;
    } else {
      //Menu is hidden, so SHOW menu
      $('#myMenu').animate({
        right: 0
      }, 800);
      mnuOut = true;
    }
  })

  var windows = [];
  var bc = new BroadcastChannel('logoff_channel');
  bc.onmessage = function (event) {
    if (event.data == 'logoff') {
      sel_logout();
    }
  }

  window.onbeforeunload = function(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
}
  $.get("/api/problem/answer", {
      pageID: "/problem/1/tasks/role/evaluation/evaluation"
    })
    .done(function (data) {
      if (JSON.parse(data)[2] === "1") {
        $("input[name=opt][value=0]").prop('checked', true);
        //$('input[name=opt]')[0].checked = true
      } else {
        $("input[name=opt][value=1]").prop('checked', true);
        //$('input[name=opt]')[1].checked = true
      }
    });

  /*function test() {
    console.log("clicked");
    $('input[name=opt]')[1].checked = true
  }*/

  $.get("/api/problem/answer", {
      pageID: "/problem/1/tasks/role/calculation/calculation",
      questionID: 1
    })
    .done(function (data) {
      //  alert( "Data Loaded: " + data );
      $("#pre_txt").html(JSON.parse(data)[0]);
    });

  function submitFun() {
    var id = $('input[name=opt]:checked').val();
    socket.emit('Driver-eval-submit',{content: id, text:name});  
    submiQuestion("2", id);
    if (id === '1') {
      $('#ExplnModal').modal("show");
      desturl = "/problem/1/tasks/role/evaluation/map";
    } else {
      $('#ExplnModal').modal("show");
      desturl = "/problem/1/tasks/role/evaluation/result";
    }
    logRecord('eval_submit')
  }

  $("#question0").focusout(function () {
    submiQuestion("0", $("#question0").val());
  });

  $("#question0").keyup(function () {
    socket.emit('Driver-eval-q0', {
      content: $("#question0").val(),
      text: name
    });
  });

  $("#question1").focusout(function () {
    submiQuestion("1", $("#question1").val());
  });

  $("#question1").keyup(function () {
    socket.emit('Driver-eval-q1', {
      content: $("#question1").val(),
      text: name
    });
  });


  function submiQuestion(pk, value) {
    $.post("/api/problem/answer", {
        pk: pk,
        pageID: window.location.pathname,
        value: value
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
        } else {
          //console.log("Please try again ");
        }
      });
  }

  function openq1hint() {
    socket.emit('Driver-eval-hint1',{text:name});
    var popup = document.getElementById('problem1eval_q1hint');
    popup.classList.toggle('show');
    logRecord('problem1eval_q1hint')
  }

  function openq2hint() {
    socket.emit('Driver-eval-hint2',{text:name});
    var popup = document.getElementById('problem1eval_q2hint');
    popup.classList.toggle('show');
    logRecord('problem1eval_q2hint')
  }

 /* //automatically save and share explanation
  $("#explain0").keyup(function () {
    socket.emit('Driver-submit-question', {
      content: $("#explain0").val(),
      text: name
    });
  });

  //automatically save and share explanation
  $("#explain0").focusout(function () {
    submiQuestion("2", $("#explain0").val());
  });*/

  var desturl = " ";

  function explanation(url) {
    $('#ExplnModal').modal("show");
    desturl = url;
  }

  function openfunc() {
    socket.emit('Driver-func',{text:name});
    explanation("/problem/1/tasks/role/functional/model/main")
  }

  function openqual() {
    socket.emit('Driver-qual',{text:name});
    explanation("/problem/1/tasks/role/qualitative/model")
  }

  function openquant() {
    socket.emit('Driver-quant',{text:name});
    explanation("/problem/1/tasks/role/quantitative/model")
  }

  function opencalc() {
    socket.emit('Driver-calc',{text:name});
    explanation("/problem/1/tasks/role/calculation/calculation")
  }

  function openeval() {
    logRecordAndJump("/problem/1/tasks/role/evaluation/evaluation")
  }


  function sendSimulatorLog() {
    socket.emit('Driver-simulator',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/simulator", '_blank'));
    logRecord('/simulator');
  }

  function sendInformationLog() {
    socket.emit('Driver-information',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/information", '_blank'));
    logRecord('/Information')
  }

  function sendScratchLog() {
    socket.emit('Driver-scratch',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/scribble", '_blank'));
    logRecord('/scribble')
  }

  function sendProblemMapLog() {
    socket.emit('Driver-problem-map',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/aboutproblem", '_blank'));
    logRecord('/Problem_Map')
  }

  function sel_logout() {
    socket.emit('Driver-logout',{text:name});
    for (var i = 0; i < windows.length; i++) {
      windows[i].close()
    }
    logRecord('/Logout');
    window.open("/logout", '_self');
  }

  function sendprobsmtlog() {
    socket.emit('Driver-problem-log',{text:name});
    logRecord('View_prob_smt');
  }

  function logRecordAndJump(urlString){
  $.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
        window.open(urlString.replace("role",JSON.parse(data).role), target = "_self");
            }
            else {
              //console.log("Please try again ");
            }
          });
}

  function logRecordAndOpen(urlString) {
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
          window.open(urlString, target = "_blank");
        } else {
          //console.log("Please try again ");
        }
      });
  }

  function logRecord(urlString) {
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
        } else {
          //console.log("Please try again ");
        }
      });
  }

  socket.on('open', function (message) {
  switch (message.content) {
   case 'Navigator-next':
      //console.log(message.nexturl);
      if (message.sessname == name)
        logRecordAndJump(message.nexturl);
      break;
  case 'Navigator-submit-question':
      if (message.sessname == name)
        $('#explain0').val(message.expln);
      break;
    }
  });
</script>
