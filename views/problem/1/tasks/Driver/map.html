<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Problem Map- MEttLE</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/stylesheets/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="/stylesheets/custom/migrated.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/css/style.css">
  <link rel="stylesheet" href="/stylesheets/css/style-2.css">
  <script src="/javascripts/vendor/go.js"></script>
  <script src="/javascripts/vendor/Buttons.js"></script>
</head>

<body>
  <section id="middlepart">
    <div class="top-section">
      <div class="row">
        <div class="col-sm-1" style="text-align:center;vertical-align:middle">
          <div class="hoverable-image">
            <img src="/images/steering-wheel.png"
              style="max-width:50px;height:auto; margin:12px; filter: invert() drop-shadow(1px 1px 4px rgba(0,0,0,0.4))" />
          </div>
        </div>
        <style>
          .hoverable-image:hover {
            opacity: 0.8;
            cursor: pointer;
          }

          .hoverable-image:hover::after {
            content: "Your are currently the Driver so you are the one to interact with the page and submit inputs";
            display: inline-block;
            left: 0px;
            top: 0px;
            padding: 5px;
            background-color: black;
            color: white;
          }
        </style>
         <!-- <div class="col-sm-3" style="text-align:center;vertical-align:middle">
          <p>You are in session {{sessionName}}</p>
        </div> -->
        <div class="col-sm-6" style="text-align:center;vertical-align:middle">
          <p>MEttLE</p>
        </div>

        <g onclick="sendSimulatorLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_sim" type="image" src="/images/simulator.png"
              style="width:110px;height:67px;" />
          </div>
        </g>

        <g onclick="sendInformationLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_info" type="image" src="/images/info.png" style="width:110px;height:67px;" />
          </div>
        </g>

        <g onclick="sendScratchLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_scribble" type="image" src="/images/scribble.png"
              style="width:110px;height:67px;" />
          </div>
        </g>

        <g onclick="sendProblemMapLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_map" type="image" src="/images/map.png" style="width:110px;height:67px;" />
          </div>
        </g>
        <div class="col-sm-1" style="text-align:center"> <button id="problem1funcmodel_logout"
            style="margin-top: 8px;height: 50px;" type="button" class="btn btn-default"
            onclick="sel_logout()">Logout</button></div>
      </div>
    </div>


    <div class="register">
      <div class="info">
        <div class="col-lg-8">
          <p>Here is a map of this problem. Click on any of the sub-goals to begin solving the problem.</p>
        </div>
        <div class="col-lg-4">
          <g onclick="sendprobsmtlog()"><a id="menuTrigger" class="dropdown-toggle" data-toggle="dropdown">Problem
              Statement</a></g>
          <div id="myMenu">
            You are participating in an electric car race in which you are required to design an electric car of weight
            5kg with wheel diameters of 4‚Äù that can traverse a track of 50m in less than 5 seconds. <br>Estimate the
            electrical power needed to achieve this performance.
          </div>
        </div>
      </div>
      <div class="container-fluid">
        <div class="col-lg-12">
          <div class="row activity" style="text-align:center">

            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2520/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink" width="560px" height="560px" viewBox="-20 -20 540 540"
              xml:space="preserve">
              <rect width="500" height="500" fill="#bdbdbd" />
              <g onclick="openfunc();">
                <polygon id="problem1map_func" points="0,250 0,500 250,500" class="task_map" />

                <text x="25" y="440" class="task_text_eg"> What does the car </text>
                <text x="25" y="460" class="task_text_eg"> need to do </text>
                <text x="25" y="480" class="task_text_eg"> that requires power? </text>
              </g>

              <g onclick="openqual();">
                <polygon id="problem1map_qual" points="0,0 0,250 250,500 500,500" class="task_map" //> <text x="40"
                  y="250" class="task_text_eg"> What are the parameters </text>
                  <text x="40" y="270" class="task_text_eg">that will effect the dominant
                    <tspan x="60" y="290" class="task_text_eg"> mechanical power required? </tspan>

                    <!--<tspan x="100" y="330" class="task_text_eg"> by various parameters? </tspan>-->
                  </text>
              </g>

              <g onclick="openquant();">
                <polygon id="problem1map_quant" points="250,0 250,250 500,500 500,250" class="task_map" />
                <text x="320" y="230" class="task_text_eg"> What is equation </text>
                <text x="320" y="250" class="task_text_eg"> connecting electric </text>
                <text x="320" y="270" class="task_text_eg"> power required to the
                  <tspan x="320" y="290" class="task_text_eg"> dominant parameters?</tspan>

                  <!--<tspan x="320" y="320" class="task_text_eg"> with other parameters? </tspan>-->
                </text>
              </g>

              <g onclick="opencalc();">
                <polygon id="problem1map_calc" points="0,0 250,250 250,0" class="task_map" />

                <text x="65" y="40" class="task_text_eg"> Substituting reasonable
                  <tspan x="70" y="60" class="task_text_eg"> values in the equation, </tspan>
                  <tspan x="85" y="80" class="task_text_eg"> what is the estimate </tspan>
                  <tspan x="105" y="100" class="task_text_eg"> of power? </tspan>
                  <!--<tspan x="125" y="120" class="task_text_eg"> calculate power. </tspan>-->
                </text>
              </g>
              <g onclick="openeval();">
                <polygon id="problem1map_eval" points="250,0 500,250 500,0" class="task_map" />

                <text x="360" y="40" class="task_text_eg"> Is the estimated
                  <tspan x="360" y="60" class="task_text_eg"> value of power </tspan>
                  <tspan x="360" y="80" class="task_text_eg"> reasonable? </tspan>
                  <!--<tspan x="360" y="100" class="task_text_eg"> reasonable? </tspan>-->
                </text>
              </g>
            </svg>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-12" >
    <div aria-hidden="true" class="modal fade" data-backdrop="false" id="ExplnModal" role="dialog" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-heading">
            <button disabled type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h2 class="modal-title">Discuss with your partner while they type the answer to the question below</h2>
          </div>
          <div class=" medium_margin"> Why did you choose this sub-goal first? </div>
          <div style="margin:20px"><textarea disabled id="explain0" class="form-control input-large " rows="5">{{answerData.[0]}}</textarea>
            </div>
          <div class="modal-body" style="float:center">
            <button disabled type="button" class="btn btn-primary" onclick="next(desturl)">Continue</button>
          </div>
         
        </div>
      </div>
    </div>
    </div>
  </section>
  <!-- modal for explanation -->

</body>

<script src="/javascripts/vendor/jquery-2.2.1.min.js"></script>
<script src="/javascripts/vendor/bootstrap.min.js"></script>
<script src="/javascripts/vendor/pnotify.custom.min.js"></script>
<script src="/javascripts/vendor/common.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>

  var socket = io('http://10.68.6.172:8080');
  var name = "{{ sessionName }}";
  //window.onclose = socket.emit('Driver-close-window',{text:name});
  
  // open problem statement
  mnuOut = false;
  $('#menuTrigger').click(function () {
    if (mnuOut) {
      //Menu is visible, so HIDE menu
      $('#myMenu').animate({
        right: '-200px'
      }, 800);
      mnuOut = false;
    } else {
      //Menu is hidden, so SHOW menu
      $('#myMenu').animate({
        right: 0
      }, 800);
      mnuOut = true;
    }
  })
  
  //close all MEttLE windows on logout
  var windows = [];
  var bc = new BroadcastChannel('logoff_channel');
  bc.onmessage = function (event) {
    if (event.data == 'logoff') {
      sel_logout();
    }
  }

  window.onbeforeunload = function(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
}

  /*$("#explain0").keyup(function () {
    socket.emit('Driver-submit-question', {
      text: $("#explain0").val()
    });
  });

  //automatically save and share explanation
  $("#explain0").focusout(function () {
    submiQuestion("0", $("#explain0").val());
  });
*/
  var desturl = " ";
  function explanation(url) {
    $('#ExplnModal').modal("show");
    desturl = url;
  }


  function next(nurl) {
    logRecordAndJump(desturl);
  }

  function submiQuestion(pk, value) {
    $.post("/api/problem/answer", {
        pk: pk,
        pageID: window.location.pathname,
        value: value
      })
      .done(function (data) {
        if (data.includes("success")) {
          //socket.emit('Driver-submit-question');
          //console.log("Data saved ");

        } else {
          //console.log("Please try again ");
        }
      });
  }

  
  function sendSimulatorLog() {
    socket.emit('Driver-simulator', {
      text: name
    });
    windows.push(window.open("/problem/1/tasks/Driver/simulator", '_blank'));
    logRecord('/simulator');
  }

  function sendInformationLog() {
    socket.emit('Driver-information', {
      text: name
    });
    windows.push(window.open("/problem/1/tasks/Driver/information", '_blank'));
    logRecord('/Information')
  }

  function sendScratchLog() {
    socket.emit('Driver-scratch', {
      text: name
    });
    windows.push(window.open("/problem/1/tasks/Driver/scribble", '_blank'));
    logRecord('/scribble')
  }

  function sendProblemMapLog() {
    socket.emit('Driver-problem-map', {
      text: name
    });
    windows.push(window.open("/problem/1/tasks/Driver/aboutproblem", '_blank'));
    logRecord('/Problem_Map')
  }

  function sel_logout() {
    socket.emit('Driver-logout', {
      text: name
    });
    for (var i = 0; i < windows.length; i++) {
      windows[i].close()
    }
    logRecord('/Logout');
    window.open("/logout", '_self');
  }

  function sendprobsmtlog() {
    socket.emit('Driver-problem-log', {
      text: name
    });
    logRecord('View_prob_smt');
  }

  

  function openfunc() {
    //console.log("The session id is");
    socket.emit('Driver-func', {
      text: name
    });
    //socket.emit('Driver-func');
    explanation("/problem/1/tasks/role/functional/model/main")
  }

  function openqual() {
    socket.emit('Driver-qual', {
      text: name
    });
    explanation("/problem/1/tasks/role/qualitative/model")
  }

  function openquant() {
    socket.emit('Driver-quant', {
      text: name
    });
    explanation("/problem/1/tasks/role/quantitative/model")
  }

  function opencalc() {
    socket.emit('Driver-calc', {
      text: name
    });
    explanation("/problem/1/tasks/role/calculation/calculation")
  }

  function openeval() {
    socket.emit('Driver-eval', {
      text: name
    });
    explanation("/problem/1/tasks/role/evaluation/evaluation")
  }

  /*function check(url) {
    //console.log("in check map for url");
    url = checkURL(url);
    //console.log(url);
    explanation(url);
  }
*/
  function logRecord(urlString) {
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
          //console.log("INLOGRECORD ---- FTER CLINKING BEGIN SLOVING ?");
        } else {
          //console.log("Please try again ");
        }
      });
  }

function logRecordAndJump(urlString){
  $.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("data saved");
              //console.log(JSON.parse(data).role);
              window.open(urlString.replace("role",JSON.parse(data).role), target = "_self");
            }
            else {
              //console.log("Please try again ");
            }
          });
}

 

  function logRecordAndOpen(urlString) {
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
          window.open(urlString, target = "_blank");
        } else {
          //console.log("Please try again ");
        }
      });
  }

socket.on('open', function (message) {
  switch (message.content) {
   case 'Navigator-next':
      //console.log(message.nexturl);
      if (message.sessname == name)
        logRecordAndJump(message.nexturl);
      break;
  case 'Navigator-submit-question':
      if (message.sessname == name)
        $('#explain0').val(message.expln);
      break;
        }
      });
</script>

