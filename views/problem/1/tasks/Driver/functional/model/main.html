<!DOCTYPE html>
<html>

<head>

  <title>Functional Modeling - MEttLE</title>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  
  <link rel="stylesheet" href="/stylesheets/vendor/bootstrap.min.css">
  <link href="/stylesheets/custom/migrated.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/stylesheets/css/style.css">
  <link rel="stylesheet" href="/stylesheets/css/style-2.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <script src="/javascripts/vendor/jquery-1.12.0.js"></script>
  <script src="/javascripts/vendor/jquery-ui.js"></script>
  <script src="/javascripts/vendor/bootstrap.min.js"></script>
  <script src="/javascripts/vendor/Buttons.js"></script>
  <link href="/stylesheets/vendor/bootstrap-editable.css" rel="stylesheet" />
  <script src="/javascripts/vendor/bootstrap-editable.min.js"></script>
   <script src="/javascripts/vendor/pnotify.custom.min.js"> </script>
  <link href="/stylesheets/custom/editable-custom.css" rel="stylesheet">
<link rel="stylesheet" href="/stylesheets/vendor/pnotify.custom.min.css">
</head>

<body>
  <section id="middlepart">
    <div class="top-section">
      <!-- defines the top-section containg the buttons for calculator,simulator,info center, scribble pad and problem map and logout -->
      <div class="row">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle" >
            <div class="hoverable-image" >
            <img src="/images/steering-wheel.png" style="max-width:50px;height:auto; margin:12px; filter: invert() drop-shadow(1px 1px 4px rgba(0,0,0,0.4))"/>
          </div>
        </div>
        <style>
          .hoverable-image:hover{
            opacity: 0.8;
            cursor: pointer;
          }

          .hoverable-image:hover::after{
          content: "Your are currently the Driver so you are the one to interact with the page and submit inputs";
          display: inline-block;
          left: 0px;
          top: 0px;
          padding: 5px;
          background-color: black;
          color: white;
          }
        </style>
        <div class="col-sm-6" style="text-align:center;vertical-align:middle">
          <p>MEttLE</p> </div>
	 <g onclick="sendSimulatorLog()"> 
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input id="problem1funcmodel_sim" type="image" src="/images/simulator.png" style="width:110px;height:67px;"/>
      </div>
     </g> 
    
    <g onclick="sendInformationLog()"> 
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input id="problem1funcmodel_info" type="image" src="/images/info.png" style="width:110px;height:67px;"/>
      </div>
      </g> 
    
    <g onclick="sendScratchLog()"> 
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input  id="problem1funcmodel_scribble"type="image" src="/images/scribble.png" style="width:110px;height:67px;"/>
      </div>
      </g> 
    
    <g onclick="sendProblemMapLog()"> 
      <div class="col-sm-1" style="text-align:center;vertical-align:middle">
        <input id="problem1funcmodel_map" type="image" src="/images/map.png" style="width:110px;height:67px;"/>
      </div>
      </g> 
      <div class="col-sm-1" style="text-align:center"> <button id="problem1funcmodel_logout" style="margin-top: 8px;height: 50px;" type="button" class="btn btn-default" onclick="sel_logout()">Logout</button></div>
    </div>
  </div>
	
	
    <div class="register">
      <div class="info">
        	<div class="row" style="text-align:center">
				        <div class="col-lg-8">
          <p style="padding-left:100px;text-align:left">What does the car need to do that requires power? </p> 
          </div>  
          <div class="col-lg-4">  
            <g onclick="sendprobsmtlog()"><a id="menuTrigger" class="dropdown-toggle" data-toggle="dropdown">Problem Statement</a></g>
           <div id="myMenu">
           You are participating in an electric car race in which you are required to design an electric car of weight 5kg with wheel diameters of 4‚Äù that can traverse a track of 50m in less than 5 seconds. <br>Estimate the electrical power needed to achieve this performance.
          </div>
          </div>
        </div>
      </div>
      <div class="container-fluid">
        <div class="row activity" style="text-align:center;">
          <div class="col-lg-6">
            <svg height="580px" id="Layer_1" version="1.1" viewbox="-30 -30 550 550" width="580px" xmlns="http://www.w3.org/2520/svg">
              <polygon class="current_subtask_map" id="problem1funcmodel_create" onclick="openfuncmodel()" points="0,250 0,500 125,375"></polygon>
             <text x="10" y="375" class="current_subtask_text">Identify all 
                    <tspan x="10" y="395"> actions </tspan>
                  </text>
              <!-- here tspan is used to change the text position withing the polygon -->
              <polygon class="subtask_map" id="problem1funcmodel_eval" onclick="openfunceval()" points="0,500 125,375 130,500"></polygon>
              <text x="65" y="450" class="subtask_text">Identify  
                  <tspan x="50" y="470"> dominant </tspan>
                    <tspan x="45" y="490"> actions </tspan>
                  </text>
              <g onclick="openfuncplan()">
              <polygon class="subtask_map" id="problem1funcmodel_plan" onclick="openfuncplan()" points="125,375 125,500 250,500"></polygon>
              <text class="subtask_text" x="150" y="450">
                Plan
                <tspan x="150" y="470">
                  Next
                </tspan>
                <tspan x="150" y="490">
                  Steps
                </tspan>
              </text>
              </g>
              <g onclick="openqual()">
              <polygon class="task_map" id="problem1funcmodel_task2"  points="0,0 0,250 250,500 500,500"></polygon>
              <text class="task_text" x="80" y="300">
                Qualitative Modeling
              </text>
              </g>
              <g onclick="openquant()">
              <polygon class="task_map" id="problem1funcmodel_task3"  points="250,0 250,250 500,500 500,250"></polygon>
              <text class="task_text" x="280" y="250">
                Quantitative Modeling
              </text>
              </g>
              <g onclick="opencalc()">
              <polygon class="task_map" id="problem1funcmodel_task4"  points="0,0 250,250 250,0"></polygon>
              <text class="task_text" x="120" y="80">
                Calculation
              </text>
              </g>
              <g onclick="openeval()">
              <polygon class="task_map" id="problem1funcmodel_task5"  points="250,0 500,250 500,0"></polygon>
              <text class="task_text" x="370" y="80">
                Evaluation
              </text>
              </g>
              <g onclick="openfuncmodel()">
              <text class="current_task_text" transform="rotate(-90 -10,500)" x="-10" y="500">
                Functional Modeling
              </text>
              <path class="current_task_path" d="M 0,250 L 0,500 L 250,500 Z" id="problem1funcmodel_task1"></path></g>
            </svg>
          </div>
          <div class="col-lg-6" style="margin-top:30px;">
            <div style="height:550px;width:550px;border-style: groove;">
			<div class="medium_margin">
                 <span class="current_subtask_text">According to the problem specifications, what does the car need to do that requires power? </span> <br> 
<br> <span class="subtask_text"> You may use the verbs and nouns given below to guide you. <br> You may also want to see the Simulator to understand the operation of the car. </span>

                </div>
                <div class="medium_margin txt_left">
                <table width="100%">
                  <tr>
                    <td><b>Verbs</b></td>
                    <td><b>Verbs</b></td>
                    <td><b>Nouns</b> </td>
                    <td><b>Nouns</b> </td>
                  </tr>
                  <tr>
                    <td> runs</td>
                    <td> drives </td>
                    <td> car </td>
                    <td> battery</td>
                  </tr>
                  <tr>
                    <td> supplies </td>
                    <td> pushes </td>
                     <td> motor </td>
                      <td> controller </td>
                   </tr>
                   
                   <tr>
                    <td> powers </td>
                    <td> uses </td>
                     <td> gears </td>
                      <td> torque </td>
                   </tr>
                  
                   <tr>
                    <td> generates </td>
                    <td> rotates </td>
                     <td> wheel </td>
                      <td> speed </td>
                   </tr>
                  
                   <tr>
                    <td> moves </td>
                    <td> has </td>
                     <td> power </td>
                     <td> voltage</td>
                   </tr>
                  
                   <tr>
                    <td> is </td>
                    <td> contains </td>
                     <td> RPM</td>
                      <td> acceleration</td>
                   </tr>
                  
                   <tr>
                    <td> regulates </td>
                    <td> overcome </td>
                     <td> current</td>
                     <td> drag </td>
                   </tr>
                  
                </table>
                </div>
              
              <div style="margin-top:17px;">
              <div class=" medium_margin"> List the identified actions here.</div>

                <div style="margin:20px"><textarea id="problem0" class="form-control input-large " rows="5">{{answerData.[0]}}</textarea></div>

                <button type="button" class="btn btn-primary btn-sm editable-submit" onclick="saveData()"><i class="glyphicon glyphicon-ok"></i></button>
                <button type="button" class="btn btn-default btn-sm editable-cancel" onclick="clearData()"><i class="glyphicon glyphicon-remove"></i></button>
              </div>
            </div>
            <div class="medium_margin subtask_text" style="width:550px">
              <button style="float:right" onclick="openfunceval();" class="btn" id="problem1funcmodel_check" type="button">Check if your list is complete</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
    <!-- modal for explanation -->
      <div aria-hidden="true" class="modal fade" data-backdrop="false" id="ExplnModal" role="dialog" tabindex="-1" >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-heading">
               <button disabled type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h2 class="modal-title">Discuss with your partner while they type the answer to the question below</h2>
            </div>
            <div class=" medium_margin"> What were you thinking as you solved that step and what did you learn? </div>
            <div style="margin:20px"><textarea disabled id="explain0" class="form-control input-large " rows="5">{{answerData.[1]}}</textarea>
            </div>
            <div class="modal-body" style="float:center">
              <button disabled type="button" class="btn btn-primary" onclick="logRecordAndJump(desturl)">Continue</button>
            </div>
          </div>
        </div>
    </div>
  </body>
   <script src="/socket.io/socket.io.js"></script>

<script>
var socket = io('http://10.68.6.172:8080');
//window.onclose = socket.emit('Driver-close-window',{text:name});
var name = "{{ sessionName }}";

// open problem statement
mnuOut=false;
$('#menuTrigger').click(function(){
  if (mnuOut){
      //Menu is visible, so HIDE menu
      $('#myMenu').animate({
        right: '-200px'
      },800);
      mnuOut = false;
  }else{
      //Menu is hidden, so SHOW menu
      $('#myMenu').animate({
        right: 0
      },800);
      mnuOut = true;
  }
});

//close all windows upon logout
var windows=[];
var bc = new BroadcastChannel('logoff_channel');
bc.onmessage =  function(event){
  if (event.data=='logoff'){
    sel_logout();
  }
}

window.onbeforeunload = function(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
}

function submiQuestion(pk,value) {
  $.post("/api/problem/answer", { pk: pk, pageID: window.location.pathname, value: value })
    .done(function(data) {
      if (data.includes("success")) {
        //console.log("Data saved ");
      }
      else {
        //console.log("Please try again ");
      }
    });
}

//automatically share model text to navigator
$("#problem0").keyup(function() { 
  socket.emit('Driver-func-model-main-p0', {
        content: $("#problem0").val(),
        text: name
      });
  });

function saveData(){
  submiQuestion("0", $("#problem0").val());
  logRecord("func_main_saveData");
}

function clearData() {
  $("#problem0").val('');
  submiQuestion("0", $("#problem0").val());
  socket.emit('Driver-clear-input', {
      content: "#problem0",
      text: name
    });
  logRecord("func_main_clearData");
}

/*//automatically save and share explanation
$("#explain0").keyup(function() { 
socket.emit('Driver-submit-question', {
      text: $("#explain0").val()
    });
});
*/

/*//automatically save and share explanation
$("#explain0").focusout(function() { 
    submiQuestion("1", $("#explain0").val());
});*/

var desturl = " ";
function explanation(url){
  $('#ExplnModal').modal("show");
  desturl = url;
}

function openfuncmodel() {
  logRecordAndJump("/problem/1/tasks/role/functional/model/main");
}

// opens the page when the respective svg is clicked
function openfunceval() {
  socket.emit('Driver-func-eval', {
      text: name
    });
  explanation("/problem/1/tasks/role/functional/evaluate/check");
}

// opens the page when the respective svg is clicked
function openfuncplan() {
  socket.emit('Driver-func-plan', {
      text: name
    });
  explanation("/problem/1/tasks/role/functional/plan");
}

function openqual() {
socket.emit('Driver-qual', {
      text: name
    });
  explanation("/problem/1/tasks/role/qualitative/model");
}

function openquant() {
  socket.emit('Driver-quant', {
      text: name
    });
  explanation("/problem/1/tasks/role/quantitative/model");
}

function opencalc() {
  socket.emit('Driver-calc', {
      text: name
    });
  explanation("/problem/1/tasks/role/calculation/calculation");
}

function openeval() {
  socket.emit('Driver-eval', {
      text: name
    });
  explanation("/problem/1/tasks/role/evaluation/evaluation");
}

function sendSimulatorLog() {
  socket.emit('Driver-simulator', {
      text: name
    });
  windows.push(window.open("/problem/1/tasks/driver/simulator", '_blank'));
  logRecord('/simulator');
}

function sendInformationLog() {
  socket.emit('Driver-information', {
      text: name
    });
  windows.push(window.open("/problem/1/tasks/driver/information", '_blank'));
  logRecord('/Information')
}

function sendScratchLog() {
  socket.emit('Driver-scratch', {
      text: name
    });
  windows.push(window.open("/problem/1/tasks/driver/scribble", '_blank'));
  logRecord('/scribble')
}

function sendProblemMapLog() {
  socket.emit('Driver-problem-map', {
      text: name
    });
  windows.push(window.open("/problem/1/tasks/driver/aboutproblem", '_blank'));
  logRecord('/Problem_Map')
}

function sel_logout() {
  socket.emit('Driver-logout', {
      text: name
    });
  for (var i = 0; i < windows.length; i++) {
    windows[i].close()
  }
  logRecord('/Logout');
  window.open("/logout", '_self');
}

function sendprobsmtlog() {
  socket.emit('Driver-problem-log', {
      text: name
    });
  logRecord('View_prob_smt');
}

/*function logRecordAndJump(urlString){
  $.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("data saved");
              //console.log(JSON.parse(data).role);
              window.open(urlString.replace("role",JSON.parse(data).role), target = "_self");
            }
            else {
              //console.log("Please try again ");
            }
          });
}
*/

function logRecordAndJump(urlString){
	$.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
    .done(function(data) {
      if (data.includes("success")) {
        //console.log("Data saved ");
			  window.open(urlString.replace("role",JSON.parse(data).role), target = "_self");
      } 
      else {
        //console.log("Please try again ");
      }
    });
    
}

function logRecordAndOpen(urlString){
	$.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
			  window.open(urlString, target = "_blank");
            }
            else {
              //console.log("Please try again ");
            }
          });
}

function logRecord(urlString){
	$.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
            }
            else {
              //console.log("Please try again ");
            }
          });
}

socket.on('open', function (message) {
  switch (message.content) {
   case 'Navigator-next':
      //console.log(message.nexturl);
      if (message.sessname == name)
        logRecordAndJump(message.nexturl);
      break;
  case 'Navigator-submit-question':
      if (message.sessname == name)
        $('#explain0').val(message.expln);
      break;
        }
      });
  </script>

</html>
