<!DOCTYPE html>
<html>

<head>
  <title>Quantitative Modeling - MEttLE</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/stylesheets/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="/stylesheets/custom/migrated.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/css/style.css">
  <link rel="stylesheet" href="/stylesheets/css/style-2.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <script src="/javascripts/vendor/Buttons.js"></script>
  <script src="/javascripts/vendor/jquery-1.12.0.js"></script>
  <script src="/javascripts/vendor/bootstrap.min.js"></script>
  <script src="/javascripts/vendor/jquery-ui.js"></script>
  <link href="/stylesheets/vendor/bootstrap-editable.css" rel="stylesheet" />
  <script src="/javascripts/vendor/bootstrap-editable.min.js"></script>
  <script src="/javascripts/vendor/pnotify.custom.min.js"></script>
  <link href="/stylesheets/custom/editable-custom.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/vendor/pnotify.custom.min.css">
</head>

<body>
  <section id="middlepart">
    <div class="top-section">
      <div class="row">
        <div class="col-sm-1" style="text-align:center;vertical-align:middle">
          <div class="hoverable-image">
            <img onclick="navigatorinfo()" src="/images/steering-wheel.png"
              style="max-width:50px;height:auto; margin:12px; filter: invert() drop-shadow(1px 1px 4px rgba(0,0,0,0.4))" />
          </div>
        </div>
        <style>
          .hoverable-image:hover {
            opacity: 0.8;
            cursor: pointer;
          }

          .hoverable-image:hover::after {
            content: "your are currently the driver so you are the one to interact with the page and submit inputs";
            display: inline-block;
            left: 0px;
            top: 0px;
            padding: 5px;
            background-color: black;
            color: white;
          }
        </style>
        <div class="col-sm-6" style="text-align:center;vertical-align:middle">
          <p>MEttLE</p>
        </div>
        <g onclick="sendSimulatorLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_sim" type="image" src="/images/simulator.png"
              style="width:110px;height:67px;" />
          </div>
        </g>

        <g onclick="sendInformationLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_info" type="image" src="/images/info.png" style="width:110px;height:67px;" />
          </div>
        </g>

        <g onclick="sendScratchLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_scribble" type="image" src="/images/scribble.png"
              style="width:110px;height:67px;" />
          </div>
        </g>

        <g onclick="sendProblemMapLog()">
          <div class="col-sm-1" style="text-align:center;vertical-align:middle">
            <input id="problem1funcmodel_map" type="image" src="/images/map.png" style="width:110px;height:67px;" />
          </div>
        </g>
        <div class="col-sm-1" style="text-align:center"> <button id="problem1funcmodel_logout"
            style="margin-top: 8px;height: 50px;" type="button" class="btn btn-default"
            onclick="sel_logout()">Logout</button></div>
      </div>
    </div>


    <div class="register">
      <div class="info">
        <div class="row" style="text-align:center">
          <div class="col-lg-8">
            <p style="padding-left:100px;text-align:left">What is equation connecting electric power required to the
              dominant parameters? </p>
          </div>
          <div class="col-lg-4">
            <g onclick="sendprobsmtlog()"><a id="menuTrigger" class="dropdown-toggle" data-toggle="dropdown">Problem
                Statement</a></g>
            <div id="myMenu">
              You are participating in an electric car race in which you are required to design an electric car of
              weight 5kg with wheel diameters of 4‚Äù that can traverse a track of 50m in less than 5 seconds.
              <br>Estimate the electrical power needed to achieve this performance.
            </div>
          </div>
        </div>
      </div>
      <div class="container-fluid">
        <div class="row activity" style="text-align:center">
          <div class="col-lg-6">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2520/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink" width="580px" height="580px" viewBox="-30 -30 550 550"
              xml:space="preserve">

              <g onclick="openfunc()">
                <polygon id="problem1quantmodel_task1" points="0,250 0,500 250,500" class="task_map" />
                <text x="5" y="450" class="task_text"> Functional Modeling</text>
              </g>
              <g onclick="openqual()">
                <polygon id="problem1quantmodel_task2" points="0,0 0,250 250,500 500,500" class="task_map" />
                <text x="80" y="300" class="task_text"> Qualitative Modeling </text>
              </g>
              <g onclick="openquant()">
                <polygon id="problem1quantmodel_create" class="current_subtask_map" points="250,0 250,250 500,250" />
                <text x="260" y="200" class="current_subtask_text"> Create the equation </text>
              </g>
              <g onclick="openquanteval()">
                <polygon id="problem1quantmodel_eval" class="subtask_map" points="250,250 375,375 500,250" />
                <text x="310" y="280" class="subtask_text">Examine its</text>
                <text x="310" y="300" class="subtask_text">completeness</text>
              </g>
              <g onclick="openquantplan()">
                <polygon id="problem1quantmodel_plan" class="subtask_map" points="375,375 500,500 500,250" />
                <text x="420" y="380" class="subtask_text">Plan Next <tspan x="420" y="400" class="subtask_text">Steps
                  </tspan></text>
              </g>
              <g onclick="opencalc()">
                <polygon id="problem1quantmodel_task4" points="0,0 250,250 250,0" class="task_map" />
                <text x="120" y="80" class="task_text"> Calculation </text>
              </g>
              <g onclick="openeval()">
                <polygon id="problem1quantmodel_task5" points="250,0 500,250 500,0" class="task_map" />
                <text x="370" y="80" class="task_text">Evaluation </text>
              </g>
              <g onclick="openquant()">
                <text x="520" y="450" class="current_task_text" transform="rotate(-90 520,450)"> Quantitative Modeling
                </text>

                <path id="problem1quantmodel_task3" d="M 250 0 L 250 250 L 500 500 L 500 250 Z"
                  class="current_task_path" />
              </g>
            </svg>
          </div>
          <div class="col-lg-6" style="margin-top: 30px;">

            <div class="subtask_text" style="height:500px;width:550px;border-style: groove;">
              <div class="medium_margin"> <span class="current_subtask_text"> Make an equation connecting dominant
                  mechanical power required to the dominant parameters. </span> <br> <span class="subtask_text"> You may
                  use the variables given below to guide you.</span> <button style="float:right" class="btn btn-primary"
                  id="problem1quantmodel_guide" type="button">Guide Me</button>

              </div>
              <div class="medium_margin txt_left">
                <table width="100%">
                  <tr>
                    <td>Power (P)</td>
                    <td>Linear Velocity (v)</td>
                    <td>Angular Velocity (w)</td>

                  </tr>
                  <tr>
                    <td>Torque (T)</td>
                    <td>Voltage (V)</td>
                    <td>Current (I)</td>

                  </tr>
                  <tr>
                    <td>Surface Area (A)</td>
                    <td>drag coefficient (Cd)</td>
                    <td>motor constant (km)</td>
                  </tr>
                  <tr>
                    <td>Mass (m)</td>
                    <td>Distance (s)</td>
                    <td>Drag force (Fd)</td>

                  </tr>
                  <tr>
                    <td>Motor Efficiency (eta)</td>
                    <td>Time Taken (t) </td>
                    <td>Acceleration (a)</td>
                  </tr>
                  <tr>
                    <td> Density (rho)</td>
                    <td>Wheel radius (r)</td>
                    <td>Accelerating force (Fa)</td>
                  <tr>
                </table>
              </div>
              <div style="margin-top:17px;">
                <div class=" medium_margin"> Enter the equation below.</div>

                <div style="margin:20px"><textarea id="question0" class="form-control input-large "
                    rows="5">{{answerData.[0]}}</textarea></div>
                <br>

                <button type="button" class="btn btn-primary btn-sm editable-submit" onclick="saveData()"><i
                    class="glyphicon glyphicon-ok"></i></button>
                <button type="button" class="btn btn-default btn-sm editable-cancel" onclick="clearData()"><i
                    class="glyphicon glyphicon-remove"></i></button>
              </div>
            </div>
            <div class="medium_margin" style="width:550px">
              <button style="float:right" onclick="openquanteval()" id="problem1quantmodel_next" type="button"
                class="btn"> Check to see if equation is complete </button>
            </div>
          </div>
        </div>
  </section>
  <!-- The guide me Modal -->
  <div id="problem1quantmodel_modal" class="modal" tabindex="-1" data-backdrop="false">
    <!-- Modal content -->
    <div class="modal-content txt_left">
      <span class="close">&times;</span>
      <span class="subtask_text">From the causal map you know the qualitative relationships between the dominant
        mechanical power and the dominant parameters. <br> <br>
        Use these relationships and the general equation for power to create an equation for power in this problem.
        Remember that you have to calculate the maximum power required by the car. <br> <br>
        You may want to look at the graphs in the simulator and information page to select suitable values for the
        constants, if any.
      </span><br>
    </div>
  </div>
  <!-- modal for explanation -->
  <div aria-hidden="true" class="modal fade" data-backdrop="false" id="ExplnModal" role="dialog" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-heading">
          <button disabled type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h2 class="modal-title">Discuss with your partner while they type the answer to the question below</h2>
        </div>
        <div class=" medium_margin"> What were you thinking as you solved that step and what did you learn? </div>
        <div style="margin:20px"><textarea disabled id="explain0" class="form-control input-large "
            rows="5">{{answerData.[1]}}</textarea>
        </div>
        <div class="modal-body" style="float:center">
          <button disabled type="button" class="btn btn-primary" onclick="logRecordAndJump(desturl)">Continue</button>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="/javascripts/vendor/jquery-2.2.1.min.js"></script>
<script src="/javascripts/vendor/bootstrap.min.js"></script>
<script src="/javascripts/vendor/common.js"></script>
<script src="/javascripts/vendor/jquery-ui.js"></script>
<script src="/javascripts/vendor/pnotify.custom.min.js"></script>

<script src="/socket.io/socket.io.js"></script>

<script>
  var socket = io('http://10.68.6.172:8080');
  var name = "{{ sessionName }}";
//window.onclose = socket.emit('Driver-close-window',{text:name});
  
  // open problem statement
  mnuOut = false;
  $('#menuTrigger').click(function () {
    if (mnuOut) {
      //Menu is visible, so HIDE menu
      $('#myMenu').animate({
        right: '-200px'
      }, 800);
      mnuOut = false;
    } else {
      //Menu is hidden, so SHOW menu
      $('#myMenu').animate({
        right: 0
      }, 800);
      mnuOut = true;
    }
  })

  var windows = [];
  var bc = new BroadcastChannel('logoff_channel');
  bc.onmessage = function (event) {
    if (event.data == 'logoff') {
      sel_logout();
    }
  }

  window.onbeforeunload = function(){
  for(var i = 0; i < windows.length; i++){
    windows[i].close()
  }
}

  function submiQuestion(pk, value) {
    $.post("/api/problem/answer", {
        pk: pk,
        pageID: window.location.pathname,
        value: value
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
        } else {
          //console.log("Please try again ");
        }
      });
  }

  $("#question0").keyup(function () {
    socket.emit('Driver-quant-model-q0', {
      content: $("#question0").val(),
      text: name
    });
  });


  function saveData() {
    submiQuestion("0", $("#question0").val());
    logRecord("quant_model_saveData");
  }


  function clearData() {
    $("#question0").val('');
    submiQuestion("0", $("#question0").val());
    socket.emit('Driver-clear-input', {
      content:"#question0",
      text: name
    });
    logRecord("quant_model_clearData")
  }

  
  //automatically save and share explanation
  /*$("#explain0").keyup(function () {
    socket.emit('Driver-submit-question', {
      text: $("#explain0").val()
    });
  });

  //automatically save and share explanation
  $("#explain0").focusout(function () {
    submiQuestion("1", $("#explain0").val());
  });*/

  var desturl = " ";

  function explanation(url) {
    $('#ExplnModal').modal("show");
    desturl = url;
  }

  function openfunc() {
    socket.emit('Driver-func',{text:name});
    explanation("/problem/1/tasks/role/functional/model/main")
  }

  function openqual() {
    socket.emit('Driver-qual',{text:name});
    explanation("/problem/1/tasks/role/qualitative/model")
  }

  function openquant() {
    socket.emit('Driver-quant',{text:name});
    explanation("/problem/1/tasks/role/quantitative/model")
  }

  function openquanteval() {
    socket.emit('Driver-quant-eval',{text:name});
    explanation("/problem/1/tasks/role/quantitative/evaluate/check")
  }

  function openquantplan() {
    socket.emit('Driver-quant-plan',{text:name});
    explanation("/problem/1/tasks/role/quantitative/plan")
  }


  function opencalc() {
    socket.emit('Driver-calc',{text:name});
    explanation("/problem/1/tasks/role/calculation/calculation")
  }

  function openeval() {
    socket.emit('Driver-eval',{text:name});
    explanation("/problem/1/tasks/role/evaluation/evaluation")
  }

  function sendSimulatorLog() {
    socket.emit('Driver-simulator',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/simulator", '_blank'));
    logRecord('/simulator');
  }

  function sendInformationLog() {
    socket.emit('Driver-information',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/information", '_blank'));
    logRecord('/Information')
  }

  function sendScratchLog() {
    socket.emit('Driver-scratch',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/scribble", '_blank'));
    logRecord('/scribble')
  }

  function sendProblemMapLog() {
    socket.emit('Driver-problem-map',{text:name});
    windows.push(window.open("/problem/1/tasks/driver/aboutproblem", '_blank'));
    logRecord('/Problem_Map')
  }

  function sel_logout() {
    socket.emit('Driver-logout',{text:name});
    for (var i = 0; i < windows.length; i++) {
      windows[i].close()
    }
    logRecord('/Logout');
    window.open("/logout", '_self');
  }

  function sendprobsmtlog() {
    socket.emit('Driver-problem-log',{text:name});
    logRecord('View_prob_smt');
  }


  // Get the modal
  var modal = document.getElementById('problem1quantmodel_modal');

  // Get the button that opens the modal
  var btn = document.getElementById('problem1quantmodel_guide');

  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];

  // When the user clicks the button, open the modal 
  btn.onclick = function () {
    socket.emit('Driver-func-fail-btn',{text:name});
    modal.style.display = "block";
    logRecord("problem1quantmodel_guideme")
  }

  // When the user clicks on <span> (x), close the modal
  span.onclick = function () {
    socket.emit('Driver-func-fail-close',{text:name});
    modal.style.display = "none";
    logRecord("problem1quantmodel_closeguideme")
  }

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function (event) {
    if (event.target == modal) {
      socket.emit('Driver-func-fail-close',{text:name});
      modal.style.display = "none";
      logRecord("problem1quantmodel_closeguideme")
    }
  }

  function logRecordAndJump(urlString){
    $.post("/api/problem/log", {pageID: window.location.pathname, value: urlString })
          .done(function(data) {
            if (data.includes("success")) {
              //console.log("Data saved ");
        window.open(urlString.replace("role",JSON.parse(data).role), target = "_self");
            }
            else {
              //console.log("Please try again ");
            }
          });
  }

  function logRecordAndOpen(urlString) {
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
          window.open(urlString, target = "_blank");
        } else {
          //console.log("Please try again ");
        }
      });
  }

  function logRecord(urlString) {
    $.post("/api/problem/log", {
        pageID: window.location.pathname,
        value: urlString
      })
      .done(function (data) {
        if (data.includes("success")) {
          //console.log("Data saved ");
        } else {
          //console.log("Please try again ");
        }
      });
  }

  socket.on('open', function (message) {
  switch (message.content) {
   case 'Navigator-next':
      //console.log(message.nexturl);
      if (message.sessname == name)
        logRecordAndJump(message.nexturl);
      break;
  case 'Navigator-submit-question':
      if (message.sessname == name)
        $('#explain0').val(message.expln);
      break;
        }
      });
</script>
